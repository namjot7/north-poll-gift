generator client {
  provider = "prisma-client-js"
  // output   = "../app/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL") // prisma 6
}

model User {
  id           String        @id @default(dbgenerated("gen_random_uuid()"))
  name         String
  email        String        @unique
  password     String
  groupMembers GroupMember[]
  votes        Vote[]
  boards       Board[]
}

model Board {
  id              String           @id @default(dbgenerated("gen_random_uuid()"))
  groupId         String
  ownerId         String // person getting the gift
  group           Group            @relation(fields: [groupId], references: [id], onDelete: Cascade)
  owner           User             @relation(fields: [ownerId], references: [id])
  giftSuggestions GiftSuggestion[]
}

model Group {
  id           String        @id @default(dbgenerated("gen_random_uuid()"))
  name         String
  createdBy    String
  boards       Board[]
  groupMembers GroupMember[]
}

model GroupMember {
  id      String @id @default(uuid())
  groupId String
  userId  String
  group   Group  @relation(fields: [groupId], references: [id], onDelete: Cascade)
  user    User   @relation(fields: [userId], references: [id])
}

model GiftSuggestion {
  id          String   @id @default(dbgenerated("gen_random_uuid()"))
  name        String
  image       String?
  link        String?
  suggestedBy String
  boardId     String
  createdAt   DateTime @default(now()) @db.Timestamp(6)
  board       Board    @relation(fields: [boardId], references: [id], onDelete: Cascade)
  votes       Vote[]
}

model Vote {
  id     String @id @default(uuid())
  userId String
  giftId String
  value  Int

  user           User           @relation(fields: [userId], references: [id])
  giftSuggestion GiftSuggestion @relation(fields: [giftId], references: [id], onDelete: Cascade)

  @@unique([userId, giftId]) // composite unique key : limits the vote to 1 per user
}
